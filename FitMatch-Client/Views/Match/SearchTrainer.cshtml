@{
    ViewData["Title"] = "SearchTrainer";
}

<script src="https://unpkg.com/vue@3"></script>

<style>
    body {
        color: #ffff;
    }

    a,
    a:hover,
    a:visited,
    a:link,
    a:active {
        text-decoration: none;
    }



    h2,
    .card-body > .text-color {
        color: #ddd;
    }

    .no-gutters {
        background: linear-gradient(90deg, #F24B88 0%, #BD00FF 100%);
        border-radius: 5px
    }

    .card-body img {
        width: 20px;
    }


    @@media (min-width: 1200px) {
        .trainerfilter .container {
            display: flex;
            max-width: 1800px;
            justify-content: center;
            margin: 0 auto;
        }
    }

    .trainerfilter .left {
        width: 30%;
        /* 左邊區塊的寬度 */
        display: flex;
        flex-direction: column;
    }

    .trainerfilter .course-widget {
        width: 70%;
    }

    .trainerfilter .right {
        width: 70%;
        /* 右邊區塊的寬度 */
        display: flex;
        flex-direction: column;
    }

    .trainerfilter .row {
        margin: 10px 0;
        /* 行與行之間的間隙 */
    }

    .left .row {
        display: flex;
        justify-content: center;
        margin: 0 auto;
    }

    .trainerfilter .circle-container {
        position: relative;
        width: 200px;
        height: 200px;
        overflow: hidden;
        border-radius: 50%;
    }

    .trainerfilter .trainer-img {
        width: 100%;
        height: auto;
    }


    .trainerfilter .form-check-label {
        margin-left: 20px;
    }
</style>

<!-- Page Header Start -->
<div class="container-fluid page-header py-5  wow fadeIn" data-wow-delay="0.1s">
    <div class="container text-center py-5">
        <h1 class="display-3 text-white text-uppercase mb-3 animated slideInDown">TRAINER</h1>
        <nav aria-label="breadcrumb animated slideInDown">
            <ol class="breadcrumb justify-content-center text-uppercase mb-0">
                <li class="breadcrumb-item"><a class="text-white" href="#">Home</a></li>
                <li class="breadcrumb-item"><a class="text-white" href="#">Pages</a></li>
                <li class="breadcrumb-item text-primary active" aria-current="page">TRAINER</li>
            </ol>
        </nav>
    </div>
</div>
<!-- Page Header End -->
<!-- Team Start -->
<section class="bgc">
    <div class="section container-xxl py-5">
        <div class="container">
            <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 600px;">
                <p class="d-inline-block bg-light text-primary py-1 px-4"></p>
                <h1 class="text-uppercase">OUR TRAINER</h1>
            </div>
            <!-- 教練篩選開始 -->
            <div class="trainerfilter"id="app">
                <div class="container ">
                    <!-- 左邊篩選區域開始 -->
                    <div class="left col-lg-4 col-md-8 pt-5" style="margin-top: 21px;">
                        <div class="row">
                            <!-- 篩選地區開始 -->
                            <div class="course-widget border py-4 px-2 mt-5 mt-lg-0">
                                <h3 class="mb-3 text-light">
                                    <i class="fa-solid fa-chevron-right pe-3"
                                       style="color: #ffffff;"></i>地區
                                </h3>
                                <div class="list-group list-group-flush">
                                    <select v-model="selectedArea" class="p-2">
                                        <option disabled>請選擇地區</option>
                                        <option v-for="area in areas" :key="area" :value="area">{{ area }}</option>
                                    </select>
                                </div>
                            </div>
                            <!-- 篩選地區結束 -->
                            <!-- 篩選性別開始 -->
                            <div class="course-widget border py-4 px-2 mt-3">
                                <h3 class="mb-3 text-light">
                                    <i class="fa-solid fa-chevron-right pe-3"
                                       style="color: #ffffff;"></i>教練性別
                                </h3>
                                <div class="list-group-item">
                                    <input class="form-check-input" id="userGender1" v-model="selectedGender" type="radio"
                                           value="全部" checked>
                                    <label class="form-check-label pt-1 ps-1" for="userGender1">全部</label>
                                </div>
                                <div class="list-group-item">
                                    <input class="form-check-input" id="userGender2" v-model="selectedGender" type="radio"
                                           value="男">
                                    <label class="form-check-label pt-1 ps-1" for="userGender2">男</label>
                                </div>
                                <div class="list-group-item">
                                    <input class="form-check-input" id="userGender3" v-model="selectedGender" type="radio"
                                           value="女">
                                    <label class="form-check-label pt-1 ps-1" for="userGender3">女</label>
                                </div>
                            </div>
                            <!-- 篩選性別結束 -->
                            <!-- 專長開始 -->
                            <div class="course-widget border py-4 px-2 mt-3">
                                <h3 class="text-light">
                                    <i class="fa-solid fa-chevron-right pe-3" style="color: #ffffff;"></i>專長項目
                                </h3>
                                <div class="d-flex justify-content-end align-items-center text-light">
                                    <input class="form-check-input me-1 mb-1" type="checkbox" name="all"
                                           onclick="check_all(this,'c')" />
                                    全選
                                </div>
                                <ul class="list-group list-group-flush">

                                    <li class="list-group-item">
                                        <input class="form-check-input" type="checkbox" name="c" value="1" />
                                        重量訓練
                                    </li>
                                    <li class="list-group-item">
                                        <input class="form-check-input" type="checkbox" name="c" value="2" />
                                        有氧課程
                                    </li>

                                    <li class="list-group-item">
                                        <input class="form-check-input" type="checkbox" name="c" value="3" />
                                        戰繩
                                    </li>

                                    <li class="list-group-item">
                                        <input class="form-check-input" type="checkbox" name="c" value="4" />
                                        格鬥訓練
                                    </li>

                                    <li class="list-group-item">
                                        <input class="form-check-input" type="checkbox" name="c" value="5" />
                                        核心訓練
                                    </li>
                                </ul>
                            </div>
                            <!-- 專長結束 -->
                            <!-- 清除篩選條件開始 -->
                            <div class="btn btn-primary p-3 m-2 course-widget" id="clearFilters">清除篩選條件</div>
                        </div>
                        <!-- 清除篩選條件結束 -->
                    </div>
                    <!-- 左邊篩選區域結束 -->
                    <!-- 右邊顯示篩選後的教練 -->
                    <div class="right col-lg-8 col-md-12">
                        <div class="row">
                            <!-- 搜尋教練名字框 -->
                            <div class="d-flex justify-content-end">
                                <i class="fa-solid fa-magnifying-glass d-flex align-items-center"
                                   style="margin-right: 5px; color: #ffff;"></i>
                                <input v-model="filterText" placeholder="請輸入搜尋資料">
                                <button class="btn btn-small"
                                        style="transform: translateY(0px);cursor: pointer;">
                                    <span class="p-2" style="font-size: 16px;">搜尋</span>
                                </button>
                            </div>
                            <!-- 篩選出的教練開始 -->
                            <div v-for="trainer in filterAndSort()" :key="trainers.trainerId" class="card border-0 bg-transparent rounded-0 mb-4">
                                <a :href="'./trainerResume?id=' + trainers.trainerId">
                                    <div class="row no-gutters p-2">
                                        <!-- 教練大頭貼 -->
                                        <div class="col-md-4 d-flex justify-content-center align-items-center">
                                            <div class="circle-container">
                                                <img v-if="trainer && trainer.photo" :src="'data:image/jpeg;base64,' + trainer.photo" :alt="trainer.trainerName" class="trainer-img">
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body team-wrap pl-4">
                                                <!-- 教練名字 -->
                                                <h3 class="card-title text-color">{{ trainers.trainerName }}</h3>
                                                <!-- 專長 -->
                                                <div class="d-flex align-items-center">
                                                    <h5>專長：</h5>
                                                    <h5 style="color: #ddd;">{{ trainers.expertise }}</h5>
                                                </div>
                                                <p class="mb-5" style="color: #ddd;">
                                                    {{ trainers.introduce }}
                                                </p>
                                            </div>
                                        </div>

                                    </div>
                                </a>
                                <!-- 篩選出的教練結束 -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 教練篩選結束 -->
            </div>
        </div>
    </div>
</section>
<!-- Section Team End -->
<!-- 專長項目的checkbox全選功能 -->
@*<script type="text/javascript">
    function check_all(obj, cName) {
        var checkboxs = document.getElementsByName(cName);
        for (var i = 0; i < checkboxs.length; i++) { checkboxs[i].checked = obj.checked; }
    }
</script>*@

<script>
    // 清除篩選
    document.addEventListener("DOMContentLoaded", function () {
        const clearFiltersButton = document.getElementById("clearFilters");
        const checkboxes = document.querySelectorAll("input[type='checkbox']");
        const selectBox = document.querySelector("select");
        const genderRadios = document.querySelectorAll("input[name='userGender']");

        clearFiltersButton.addEventListener("click", function () {
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });

            selectBox.selectedIndex = 0;

            genderRadios.forEach(radio => {
                if (radio.value === "全部") {
                    radio.checked = true;
                } else {
                    radio.checked = false;
                }
            });
        });
    });

    //開始渲染嚕
    const app = Vue.createApp({
        data() {
            return {
                trainers: [],
                areas: [],
                filterText: '',
                selectedArea: '',
                selectedGender: '全部',
                selectedSkills: []
            };
        },
        mounted() {
            this.fetchtrainers();
            // 從 trainers 數據中提取不同的地區前三個字
            const areaSet = new Set();
            this.trainers.forEach(trainer => {
                const areaPrefix = trainer.address.substring(0, 3);
                areaSet.add(areaPrefix);
            });
            this.areas = Array.from(areaSet);
        },
        methods: {
            async fetchtrainers() {
                try {
                const res = await fetch('https://localhost:7011/api/Match/Trainer');
                this.trainers = await res.json();
                } catch (error) {
                    console.error("找不到Api:", error);
                }
                this.trainers.forEach(trainer => {
                    trainer.genderText = trainer.gender ? '女' : '男';
                    trainer.areaPrefix = trainer.address.substring(0, 3);
                });
            },
            filterAndSort() {
                return this.trainers
                    .filter(c => c.trainerName.includes(this.filterText) || c.expertise.includes(this.filterText))
                    .filter(c => this.selectedGender === '全部' || c.genderText === this.selectedGender)
                    .filter(c => !this.selectedArea || c.areaPrefix === this.selectedArea)
                    .filter(c => !this.selectedSkills.length || this.selectedSkills.some(skill => c.expertise.includes(skill)));
            },
            clearFilters() {
                this.filterText = '';
                this.selectedArea = '';
                this.selectedGender = '全部';
                this.selectedSkills = [];
            }
        }
    }).mount('#app');
</script>