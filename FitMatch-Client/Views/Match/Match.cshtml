﻿@{
    ViewData["Title"] = "Match";
}
<script src="https://unpkg.com/vue@3"></script>
<link href="~/css/Match.css" rel="stylesheet">


<div class="container">
    <!-- Page Header Start -->
    <div class="match-title">
        <div class="container-fluid py-5 mb-4 wow fadeIn" data-wow-delay="0.1s">
            <div class="container text-center py-5">
                <h1 class="text-white text-uppercase mb-3 animated slideInDown">與我們卓越的金牌教練共同提升您的運動體驗!</h1>
                <h4 class="breadcrumb-item text-white m-5">針對個人需求提供量身定制的教練服務</h4>
            </div>
            <div class="row d-flex align-content-center justify-content-between">
                <div class="col text-end">
                    <a asp-controller="Match" asp-action="SearchTrainer" class="btn btn-dark"
                       style="border-radius:10px; border: 1px solid #7c7c7c; padding:20px 40px;">
                        <h3>找教練</h3>
                    </a>
                </div>
                <div class="col text-start">
                    <a asp-controller="Gym" asp-action="Gym" class="btn btn-dark"
                       style="border-radius:10px;border: 1px solid #7c7c7c; padding:20px 40px;">
                        <h3>找場館</h3>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- 推薦教練頭像Start -->
    <div id="trainerTop5">
        <div class="tcircle container-xxl py-1">
            <div class="row g-4 d-flex justify-content-center">
                <div class="col-lg-2 col-md-4 wow fadeInUp" data-wow-delay="0.1s"
                     v-for="(trainer, index) in trainerteams" :key="trainer.trainerId">
                    <div class="top-label">TOP{{ index + 1 }}</div>
                    <div class="team-item mx-auto d-flex align-items-center">
                        <div class="team-img position-relative overflow-hidden d-flex align-items-center">

                            <img class="img-fluid" :src="'data:image/jpeg;base64,' + trainer.photo"
                                 :alt="trainer.trainerName">
                            <div class="team-social">
                                <a class="btn btn-primary"
                                   :href="'/Match/TrainerResume?id=' + trainer.trainerId">我要預約</a>
                            </div>
                        </div>
                    </div>
                    <div class="text-center p-4">
                        <h5 class="text-uppercase">{{ trainer.trainerName }}</h5>
                    </div>
                </div>
            </div>
        </div>
        <!-- 推薦教練頭像End -->
        <!-- 巨石強森推薦區 Start -->
        <div class="rock container-xxl py-1 wow fadeInUp" data-wow-delay="0.1s">
            <div class="card bg-transparent mb-4" style="width: 100%;">
                <div class="row no-gutters">
                    <!-- 教練大頭貼 -->
                    <div class="col-md-6">
                        <div class="circle-container mx-auto">
                            @*<img src="~/images/教練/巨石強森.jpg" alt="" class="trainer-img">*@
                            <img class="trainer-img" :src="'data:image/jpeg;base64,' + trainer1Photo" alt="巨石強森" v-if="trainer1Photo">

                        </div>
                        <!-- 教練名字 -->
                        <h3 class="card-title text-light text-center py-2">巨石強森</h3>


                        <!-- 社群 -->
                        <div class="d-flex align-items-center mb-2">
                            <p class="card-subtitle letter-spacing m-auto">
                                <i class="fa-brands fa-square-facebook fa-xl me-2 fc-232323"></i>
                                <i class="fa-brands fa-linkedin fa-xl me-2 fc-232323"></i>
                                <i class="fa-brands fa-square-instagram fa-xl fc-232323"></i>
                            </p>
                        </div>
                    </div>


                    <div class="col-md-5 d-flex align-items-center">
                        <div class="rock-card card-body team-wrap pl-5 text-light pt-5">
                            <h4 class="px-3">超越極限，與巨石強森一同塑造你的力量</h4>
                            <p class="text-black fw-bold px-3 pt-3">
                                巨石強森憑藉自身的豐富經驗和知識，為你提供全面的健身指導。無論你是初學者還是有經驗的健身愛好者，他都能根據你的需求和目標制定量身定制的訓練計劃。他強調正確的技巧和姿勢，並注重每個動作的細節，確保你的訓練效果最大化。
                            </p>
                            <div class="d-flex justify-content-center">
                                <div class="btn btn-dark" style="border-radius:8px" data-bs-toggle="modal"
                                     data-bs-target="#myModal">
                                    查看詳細資訊
                                </div>
                            </div>
                            <!-- 詳細資訊 -->
                            <div class="modal fade" id="myModal" tabindex="-1"
                                 aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content detailcard p-2">
                                        <div class="d-flex justify-content-end">
                                            <button type="button" class="btn-close " data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body text-light">
                                            <div class="modal-body">
                                                <ul>
                                                    <li>原名為洛克（The Rock），在1996年加入世界摔角娛樂（WWE，前身為WWF）。</li>
                                                    <li>曾經11次獲得WWE世界冠軍。</li>
                                                    <li>獲得兩次WWE洲際冠軍和五次WWE雙打冠軍。</li>
                                                    <li>
                                                        在2000年至2001年間成為WWE世界冠軍連續擊敗「斯杰夫・奧斯汀」(Stone Cold Steve
                                                        Austin)，稱霸WWE。
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <a href="/Match/TrainerResume?id=1" class="btn btn-dark"
                                               style="border-radius:8px">立即預約</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 詳細資訊End -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 巨石強森推薦區 End -->
    <!-- 實際上課照片Start -->
    <div class="container wow fadeInUp" data-wow-delay="0.1s">
        <h3>實際上課照片</h3>
        <div class="image-box photocarousel">
            <div class="image-list">
                <div class="item"></div>
            </div>
        </div>
    </div>
    <!-- 實際上課照片End -->
    <!-- 尋找你想媒合的課程內容Start -->
    <div class="course-photo container-xxl wow fadeInUp pt-3" data-wow-delay="0.1s" id="classtypes">
        <h3>尋找你想媒合的課程</h3>
        <div class="row g-4 justify-content-between">
            <div class="col-lg-2 col-md-6 col-sm-12" v-for="classtype in classtypes" :key="classtype.classTypeId">
                <div class="team-item mx-auto">
                    <div class="team-img position-relative overflow-hidden align-items-center">
                        <img class="img-fluid" :src="'data:image/jpeg;base64,' + classtype.photo"
                             :alt="classtype.className">
                        <div class="team-social">
                            <a class="btn btn-primary" :href="'/Classtype/coursedetail/detail?id=' + classtype.classTypeId">查看課程</a>
                        </div>
                    </div>

                </div>
                <div class="bg-darkgray text-center p-2">
                    <h5 class="text-uppercase">{{ classtype.className }}</h5>
                </div>

            </div>
        </div>

    </div>
    <!-- 尋找你想媒合的課程內容End -->
    <!-- 學員評價Start -->
    <div class="container wow fadeInUp pt-5" data-wow-delay="0.1s" id="reviews">
        <h3>學員評價</h3>
        <div class="review-box" @@mouseover="pauseScroll" @@mouseleave="resumeScroll" ref="box1">
            <div class="review-list" ref="list1">
                <div class="item" v-for="review in reviews">
                    <p>{{ review.comment }}</p>
                    <span>- {{ review.memberName }}</span>
                </div>
            </div>
        </div>
        <div class="review-box" ref="box2">
            <div class="review-list" ref="list2">
                <div class="item" v-for="review in reversedReviews">
                    <p>{{ review.comment }}</p>
                    <span>- {{ review.memberName }}</span>
                </div>
            </div>
        </div>

        <!-- <div class="review-box" id="box1">
            <div class="review-list" id="list1">
                <div class="item"></div>
            </div>
        </div> -->
        <!-- <div class="review-box" id="box2">
            <div class="review-list" id="list2">
                <div class="item"></div>
            </div>
        </div> -->
    </div>
    <!-- 學員評價End -->
    <!-- 與我們合作的場地Start -->
    <div class="gym-photo course-photo container-xxl pt-5 wow fadeInUp" data-wow-delay="0.1s" id="Gyms">
        <h3>與我們合作的健身場館</h3>
        <div class="row g-4 justify-content-between">
            <div class="col-lg-3 col-md-3" v-for="gym in gyms" :key="gym.gymId">
                <div class="team-item mx-auto">
                    <div class="team-img position-relative overflow-hidden align-items-center">
                        <img class="img-fluid" :src="'data:image/jpeg;base64,' + gym.photo"
                             :alt="gym.gymName">
                        <div class="team-social">
                            <a class="btn btn-primary" :href="'/Gym/Gym?id=' + gym.gymId">我要預約</a>
                        </div>
                    </div>

                </div>
                <div class="bg-darkgray text-center p-2">
                    <h5 class="text-uppercase">{{ gym.gymName }}</h5>
                </div>

            </div>
        </div>
    </div>
    <!-- 與我們合作的場地End -->

</div>
<script>

    const app1 = Vue.createApp({
        data() {
            return {
                trainerteams: [],
                trainer1Photo: null
            };
        },
        mounted() {
            this.fetchTrainers();
        },
        methods: {
            async fetchTrainers() {
                try {
                    const response = await fetch(`https://localhost:7011/api/Match/Trainer`);
                    const data = await response.json();
                    // 根據課程預約率做排序
                    data.sort((a, b) => b.classCount - a.classCount);
                    // 只保留前5筆教練
                    this.trainerteams = data.slice(0, 5);
                    // 找到 trainerId 為 1 的教練
                    const trainer1 = data.find(trainer => trainer.trainerId === 1);

                    if (trainer1) {
                        this.trainer1Photo = trainer1.photo;
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }
    }).mount("#trainerTop5");
    const app2 = Vue.createApp({
        data() {
            return {
                gyms: []
            };
        },
        mounted() {
            this.fetchTrainers();
        },
        methods: {
            async fetchTrainers() {
                try {
                    const response = await fetch(`https://localhost:7011/api/Match/Gym`);
                    const data = await response.json();
                    this.gyms = data.slice(0, 4);
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }
    }).mount("#Gyms");
    // 學員評價輪播
    const app3 = Vue.createApp({
        data() {
            return {
                reviews: [],
                reversedReviews: [],
                scroll1: 0,
                scroll2: 0,
                isPaused: false,
                scrollSpeed1: 0.4,
                scrollSpeed2: 0.3,

            };
        }, async mounted() {
            try {
                const response = await fetch(`https://localhost:7011/api/Match/Reviews`);
                if (response.ok) {
                    const data = await response.json();
                    this.reviews = data;
                    this.reversedReviews = [...this.reviews].reverse(); // 反轉reviews數據

                    this.startScrolling();
                } else {
                    console.error('Failed to fetch reviews:', response.status);
                }
            } catch (error) {
                console.error('An error occurred while fetching data:', error);
            }

            this.startScrolling();
        },
        methods: {
            pauseScroll() {
                this.isPaused = true;
            },
            resumeScroll() {
                this.isPaused = false;
            },
            startScrolling() {
                const list1 = this.$refs.list1;
                const list2 = this.$refs.list2;

                const box2 = this.$refs.box2;

                // 設定第二排的初始位置
                this.scroll2 = -box2.offsetWidth;

                const scrollFunction = () => {
                    if (!this.isPaused) {
                        // 第一排滾動邏輯
                        this.scroll1 += this.scrollSpeed1;
                        if (this.scroll1 >= list1.offsetWidth) {
                            this.scroll1 = 0;
                        }
                        list1.style.transform = `translateX(-${this.scroll1}px)`;

                        // 第二排滾動邏輯
                        this.scroll2 += this.scrollSpeed2;
                        if (this.scroll2 >= 0) {
                            this.scroll2 = -box2.offsetWidth;
                        }
                        list2.style.transform = `translateX(${this.scroll2}px)`;
                    }

                    requestAnimationFrame(scrollFunction);
                };

                requestAnimationFrame(scrollFunction);

            }
        }
    }).mount("#reviews");



    //課程
    const app4 = Vue.createApp({
        data() {
            return {
                classtypes: []
            };
        },
        mounted() {
            this.fetchTrainers();
        },
        methods: {
            async fetchTrainers() {
                try {
                    const response = await fetch(`https://localhost:7011/api/Match/ClassTypes`);
                    const data = await response.json();
                    this.classtypes = data.slice(0, 6);
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }
    }).mount("#classtypes");

    // 上課照片輪播
    var images = [];
    for (var i = 1; i <= 32; i++) {
        images.push(`/images/上課照片/${i}.jpg`);
    }

    function loadImages() {
        var list = document.querySelector('.image-list');
        var box = document.querySelector('.image-box');
        var itemWidth = 200 + 2 * 24;
        var scrollSpeed = 0.5;
        var currentPosition = 0;

        function addImage(src) {
            var item = document.createElement('div');
            item.className = 'item';
            var img = document.createElement('img');
            img.src = src;
            item.appendChild(img);
            list.appendChild(item);
        }

        function clearImages() {
            list.innerHTML = ''; // 清空原有照片
        }

        function fillImages() {
            clearImages();
            for (var k = 0; k < Math.ceil(1296 / itemWidth); k++) {
                for (var i = 0; i < images.length; i++) {
                    addImage(images[i]);
                }
            }
        }

        fillImages();

        function move() {
            currentPosition -= scrollSpeed;
            if (currentPosition <= -itemWidth * images.length) {
                currentPosition = 0;
            }
            list.style.transform = `translateX(${currentPosition}px)`;
            requestAnimationFrame(move);
        }

        move();

        box.onmouseover = function () {
            scrollSpeed = 0;
        };

        box.onmouseleave = function () {
            scrollSpeed = 0.5;
        };
    }

    document.addEventListener('DOMContentLoaded', loadImages);
</script>