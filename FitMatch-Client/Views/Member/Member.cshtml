@{
    ViewBag.SubLayout = "Member";
    Layout = "~/Views/Shared/_MemberLayout.cshtml";
}

<style>
    .rounded-image-container {
        width: 350px;
        height: 350px;
        border-radius: 50%;
        overflow: hidden;
    }

    .rounded-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    /*專長欄位*/
    .checkbox-container {
        display: flex;
        flex-wrap: wrap;
    }

    .checkbox-item {
        flex-basis: 50%;
        display: flex;
        align-items: center;
    }

        .checkbox-item::before {
            content: "";
            display: inline-block;
            width: 6px;
            height: 6px;
            margin-right: 8px;
        }

</style>

<!-- body start -->

<div class="container bg-white">
    <!-- 會員基本資料 Start -->
    <div class="container">
        <div class="container-fluid pt-4 px-4">
            <form>
                <div class="row justify-content-between">
                    <!--左攔-->
                    <div class="col-6">                      
                        <!-- 姓名 -->
                        <div class="row align-items-center mb-3">
                            <label for="memberNameInput" class="col-3 text-center col-form-label">中文姓名</label>
                            <div class="col-9">
                                <input class="form-control mb-3 memberNameInput" type="text" disabled>
                            </div>
                        </div>
                        <!-- 生日 -->
                        <div class="row align-items-center mb-3">
                            <label for="inputname" class="col-3 text-center col-form-label">生日</label>
                            <div class="col-9">
                                <input class="form-select memberBirthInput" style="background-color:#f1f1f1;"
                                       type="date" name="birth" value="2023-01-01" disabled>
                            </div>
                        </div>
                        <!-- 性別 -->
                        <div class="row align-items-center mb-3">
                            <label for="inputname" class="col-3 text-center col-form-label">
                                性別
                            </label>
                            <div class="col-9">
                                <select class="form-select memberGenderInput"
                                        aria-label="性別" name="add1" size="1" disabled>
                                    <option>男</option>
                                    <option selected>女</option>
                                </select>
                            </div>
                        </div>
                        <!-- Email -->
                        <div class="row align-items-center mb-3">
                            <label for="membercourseFeeInput" class="col-3 text-center col-form-label">Email</label>
                            <div class="col-9">
                                <input class="form-control mb-3 memberEmailInput" type="text" disabled>
                            </div>
                        </div>
                        <!-- 電話 -->
                        <div class="row align-items-center mb-3">
                            <label for="memberPhoneInput" class="col-3 text-center col-form-label">電話</label>
                            <div class="col-9">
                                <input class="form-control mb-3 memberPhoneInput" type="text"
                                       aria-label="電話" disabled>
                            </div>
                        </div>
                        <!-- 地址 -->
                        <div class="row align-items-center mb-3">
                            <label for="memberAddressInput" class="col-3 text-center col-form-label">地址</label>
                            <div class="col-9">
                                <input class="form-control mb-3 memberAddressInput" type="text" aria-label="請輸入地址"  disabled>
                            </div>
                        </div>
                        <!-- 會員狀態 -->
                        <div class="row align-items-center mb-3">
                            <label for="inputname" class="col-3 text-center col-form-label">
                                會員狀態
                            </label>
                            <div class="col-9">
                                <select class="form-select memberStatusInput"
                                        aria-label="會員狀態" name="add2" size="1" disabled>
                                    <option>有效會員</option>
                                    <option selected>無效會員</option>
                                </select>
                            </div>
                        </div>
                        <!-- 入會時間 -->
                        <div class="row align-items-center mb-3">
                            <label for="inputname" class="col-3 text-center col-form-label">入會時間</label>
                            <div class="col-9">
                                <input class="form-select memberCreateAtInput" style="background-color:#f1f1f1;"
                                       type="date" name="birth" value="2023-01-01" disabled>
                            </div>
                        </div>
                    </div>
                    <!-- 第二攔 -->
                    <!-- 照片 -->
                    <div class="col-6 d-flex justify-content-center ps-5">
                        <div class="rounded-image-container">
                            <img src="~/images/nopersonal.jpg" class="rounded-image" id="member-img" />
                        </div>
                    </div>
                </div>
                <hr>
                <!-- 第二區塊 -->
                <div class="row justify-content-between">
                    <div class="container text-center">
                        <button type="button" class="btn rounded-pill m-2"
                                style="background-color: #F24B88;">
                            <a href="personal_member_Basic_Information_Data_Modification.html"
                               style="color: #fff;">修改</a>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Form End -->
<!-- 會員基本資料 End -->
<!-- body end -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script>

    $(document).ready(function () {
        const memberId = 1;

        // 第一個 AJAX 請求
        $.ajax({
            url: 'https://localhost:7011/api/Member/' + memberId,
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                $('.memberNameInput').val(data.memberName);
                $('.memberAddressInput').val(data.address);
               /*  $('.memberBirthInput').val(data.birth); */ // 這裡需要確認
                $('.memberPhoneInput').val(data.phone);
                // $('.memberGenderInput').val(data.gender);
                $('.memberEmailInput').val(data.email);
                $('.memberCreatedAtInput').val(data.createdAt);
                $('.memberStatusInput').val(data.status);
                $('.memberPasswordInput').val(data.password);


               var ID = memberId;
                $('.memberIDInput').text(ID);
                var name = data.memberName;
                $('.memberNameInput').text(name); 
                // 假設你已經成功獲取到 Email，存在變數 data.email 中
                var email = data.email;
                $('.memberEmailInput').text(email);



                var birthDate = new Date(data.birth); // 假設 data.birth 包含日期時間值
                var formattedBirthDate = birthDate.toISOString().split('T')[0]; // 格式化為 YYYY-MM-DD
                $('.memberBirthInput').val(formattedBirthDate);

                var gender = data.gender ? "男" : "女";
                $('.memberGenderInput').val(gender);

                var status = data.status ? "有效會員" : "無效會員";
                $('.memberStatusInput').val(status);



                var Photo = data.photo; //照片
                // 更新會員照片
                var memberPhotoElement = document.querySelector("#member-img");

                if (Photo) {
                    var memberImageBase64 = Photo; // 從API獲取的Base64編碼的照片
                memberPhotoElement.src = "data:image/jpeg;base64," + memberImageBase64; // 直接將圖像設置為src
               
                }

                // ... 其他的資料設定
            },
            error: function (error) {
                console.log("Error:", error);
            }
        });

    });
</script>


<script>

    const memberIdFromSession = sessionStorage.getItem('memberId');
    if (!memberIdFromSession) {
        console.error("memberId not found in session storage");
        // You can also redirect the user or show an error message, if necessary.
    }

    Vue.createApp({
        data() {
            return {
                MemberFavorites: [],

                favoritesWithTrainersAndProducts1: [],
                favoritesWithTrainersAndProducts2: [],
                memberId: sessionStorage.getItem('memberId'),
                token: sessionStorage.getItem('token'),
                showTrainer: 'trainer'
            };
        },
        mounted() {
            if (!this.memberId || !this.token) {
                console.error("memberId or token not found in session storage");
                // You can also redirect the user or show an error message, if necessary.
                return;
            }
            this.MemberFavorite();
        },
        methods: {
            MemberFavorite() {

                const headers = new Headers();
                headers.append('Authorization', `Bearer ${this.token}`);

                if (!memberIdFromSession) {
                    console.error("memberId not provided in the session");
                    return;
                }

                // Assuming the token is stored in the session storage.
                // Adjust if it's stored elsewhere.
                const token = sessionStorage.getItem('token');
                if (token) {
                    headers.append('Authorization', `Bearer ${token}`);
                }

                fetch(`https://localhost:7011/api/MemberFavorite/${this.memberId}`, {
                    headers: headers
                })
                    .then((response) => {
                        if (!response.ok) {
                            return response.text().then(text => {
                                throw new Error(`API request failed with status ${response.status}: ${text}`);
                            });
                        }
                        return response.json();
                    })
                    .then((data) => {
                        console.log(data);
                        this.MemberFavorites = data;
                    })
                    .catch((error) => {
                        console.error("API 請求失敗: " + error.message);
                    });
            },
        },
    }).mount('#app')
</script>