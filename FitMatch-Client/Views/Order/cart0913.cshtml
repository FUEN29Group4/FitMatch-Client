@{
    ViewData["Title"] = "cart0913";
}



@*  ======  增加之後待使用 start ====== *@
<!-- 增加Vue跟axios跟jQuery 函式庫CDN-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.0/axios.js"></script>
<script src="https://unpkg.com/vue@3"></script>
<script src="https://unpkg.com/vuex@4"></script>


@* ====== 原先Html樣式 start ====== *@
<!--Mall的樣式css-->
<link rel="stylesheet" href="~/css/Mall.css/bootstrap.min.css">

<link rel="stylesheet" href="~/css/Mall.css/owl.theme.default.min.css">

<link rel="stylesheet" href="~/css/Mall.css/owl.carousel.min.css">

<link rel="stylesheet" href="~/css/Mall.css/remixicon.css">

<link rel="stylesheet" href="~/css/Mall.css/meanmenu.min.css">

<link rel="stylesheet" href="~/css/Mall.css/animate.min.css">

<link rel="stylesheet" href="~/css/Mall.css/style.css">

<link rel="stylesheet" href="~/css/Mall.css/responsive.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />


@* ====== 泰迪Html樣式 start ====== *@
<style>
    body {
        font: normal 18px Tahoma,Arial,Verdana;
    }

    #myCart {
        margin: 0 auto;
        width: 900px;
        border: 1px solid #fff;
    }

    input {
        width: 60px;
    }

    tr {
        border-bottom: 1px dotted #aaa;
    }

    td {
        margin: 0px;
        padding: 1px 10px 4px 10px;
        border-bottom: 1px dotted #ccc;
        text-align: left;
        vertical-align: top;
    }

    #cartList {
        font-size: medium;
        font-weight: 800;
        border-bottom: 1px solid #aaa;
    }

    #subtotal {
        font-size: medium;
        font-weight: 600;
        color: Maroon;
    }
</style>



<!-- Page Header Start -->
<div class="container-fluid page-header py-5 mb-5 wow fadeIn" data-wow-delay="0.1s">
    <div class="container text-center py-5">
        <h1 class="display-3 text-white text-uppercase mb-3 animated slideInDown">ShoppingCart</h1>
        <nav aria-label="breadcrumb animated slideInDown">
            <ol class="breadcrumb justify-content-center text-uppercase mb-0">
                <li class="breadcrumb-item"><a class="text-white" href="#">首頁</a></li>
                <li class="breadcrumb-item"><a class="text-white" href="#">商城</a></li>
                <li class="breadcrumb-item text-primary active" aria-current="page">購物車</li>
            </ol>
        </nav>
    </div>
</div>
<!-- Page Header End -->
@*======= 泰迪cart start =======*@
<div id="myCart">
    <h1>
        Shopping Cart
    </h1>
    <header id="cartList">
        <table style="border-bottom:1px solid #ddd;">
            <tr class="itemHead">
                @*改改到這裡*@
                <td style="width:200px;">Item List</td>
                <td style="width:280px;">品名</td>
                <td style="width:170px;">Price($)</td>
                <td style="width:60px;">Item(s)</td>
            </tr>
        </table>
        @*動態自動加在底下這裡*@

    </header>
   @*  <footer style="text-align:right;">
        Total : <span id="total">0</span>
    </footer> *@
</div>
@*======= 泰迪cart end =======*@



@*  ======  body start ====== *@
<!-- Team Start -->
<section class="cart-area ptb-54">
    <div class="container">
        <div class="row ">
            <div class="col-lg-9">
                <div class="col-lg-4 col-md-4">
                </div>
                <form class="cart-controller">
                    <div class="cart-table table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">商品</th>
                                    <th scope="col"></th>
                                    <th scope="col">金額</th>
                                    <th scope="col">數量</th>
                                    <th scope="col">小計</th>
                                    <th scope="col" class="ps-4">刪除</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="product-details.html">
                                            <img src="images/商城/peeta.jpg" alt="Image">
                                        </a>
                                    </td>
                                    <td class="product-name">
                                        <a href="product-details.html">
                                            DFMALB 20V Max XX Oscillating Multi <br> Tool
                                            Variable Speed Tool
                                        </a>
                                    </td>
                                    <td class="product-price">
                                        <span class="unit-amount">$90.00</span>
                                    </td>
                                    <td class="product-quantity">
                                        <div class="input-counter">
                                            <span class="minus-btn">
                                                <i class="fa-solid fa-minus"></i>
                                            </span>
                                            <input id="counter" type="text" value="0" min="0">
                                            <span class="plus-btn">
                                                <i class="fa-solid fa-plus"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="product-subtotal">
                                        <span class="subtotal-amount">$90.00</span>
                                    </td>
                                    <td class="trash">
                                        <a href="" class="remove">
                                            <i class="fa-solid fa-trash" style="color: #f24b88;"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="product-details.html">
                                            <img src="images/商城/brand.jpg" alt="Image">
                                        </a>
                                    </td>
                                    <td class="product-name">
                                        <a href="product-details.html">
                                            Power Tools Set Chinese Manufacturer <br>
                                            Production 50V Lithu Battery
                                        </a>
                                    </td>
                                    <td class="product-price">
                                        <span class="unit-amount">$50.00</span>
                                    </td>
                                    <td class="product-quantity">
                                        <div class="input-counter">
                                            <span class="minus-btn">
                                                <i class="fa-solid fa-minus"></i>
                                            </span>
                                            <input id="counter" type="text" value="0" min="0">
                                            <span class="plus-btn">
                                                <i class="fa-solid fa-plus"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="product-subtotal">
                                        <span class="subtotal-amount">$50.00</span>
                                    </td>
                                    <td class="trash">
                                        <a href="" class="remove">
                                            <i class="fa-solid fa-trash" style="color: #f24b88;"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="product-details.html">
                                            <img src="images/商城/肌酸.jpg" alt="Image">
                                        </a>
                                    </td>
                                    <td class="product-name">
                                        <a href="product-details.html">
                                            Electrical Magnetic Impact Power <br> Hammer
                                            Drills Machine
                                        </a>
                                    </td>
                                    <td class="product-price">
                                        <span class="unit-amount">$30.00</span>
                                    </td>
                                    <td class="product-quantity">
                                        <div class="input-counter">
                                            <span class="minus-btn">
                                                <i class="fa-solid fa-minus"></i>
                                            </span>
                                            <input id="counter" type="text" value="0" min="0">
                                            <span class="plus-btn">
                                                <i class="fa-solid fa-plus"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="product-subtotal">
                                        <span class="subtotal-amount">$30.00</span>
                                    </td>
                                    <td class="trash">
                                        <a href="" class="remove">
                                            <i class="fa-solid fa-trash" style="color: #f24b88;"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="product-details.html">
                                            <img src="images/商城/B.webp" alt="Image">
                                        </a>
                                    </td>
                                    <td class="product-name">
                                        <a href="product-details.html">
                                            Professional Cordless Drill Power Tools <br>
                                            Set Competitive Price
                                        </a>
                                    </td>
                                    <td class="product-price">
                                        <span class="unit-amount">$45.00</span>
                                    </td>
                                    <td class="product-quantity">
                                        <div class="input-counter">
                                            <span class="minus-btn">
                                                <i class="fa-solid fa-minus"></i>
                                            </span>
                                            <input id="counter" type="text" value="0" min="0">
                                            <span class="plus-btn">
                                                <i class="fa-solid fa-plus"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <td class="product-subtotal">
                                        <span class="subtotal-amount">$45.00</span>
                                    </td>
                                    <td class="trash">
                                        <a href="" class="remove">
                                            <i class="fa-solid fa-trash" style="color: #f24b88;"></i>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
                <div class="coupon-cart">
                    <div class="row">
                        <div class="col-lg-8 col-md-8">
                            <div class="form-group mb-0">
                                <input type="text" class="form-control" placeholder="Coupon code">
                                <button class="btn btn-primary">
                                    Apply Coupon
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <div class="col-lg-3">
                <div class="cart-totals">
                    <h3 class="cart-checkout-title">結帳金額</h3>
                    <ul>
                       @*  <li>小計 <span>0</span></li> *@
                       @*  <li>稅金 <span>$00.00</span></li> *@
                        <li>總金額 <span id="total">0</span></li>
                        <li>優惠折扣 <span id="優惠id">0</span></li>
                        <li><b>折扣後金額</b><span id="折扣後id"><b>0</b></span></li>
                    </ul>
                    <div class="text-center">
                        <a href="checkout.html" class="btn btn-primary" style="min-width: 200px;
    margin: auto;">
                            結帳
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>



<!-- Back to Top -->
<a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>




@* ======== 原先JS樣式 start ======== *@
<!--Mall的效果JS-->
<script src="~/js/Mail.js/jquery.min.js"></script>
<script src="~/js/Mail.js/bootstrap.bundle.min.js"></script>
<script src="~/js/Mail.js/meanmenu.min.js"></script>
<script src="~/js/Mail.js/owl.carousel.min.js"></script>
<script src="~/js/Mail.js/wow.min.js"></script>
<script src="~/js/Mail.js/range-slider.min.js"></script>
<script src="~/js/Mail.js/form-validator.min.js"></script>
<script src="~/js/Mail.js/contact-form-script.js"></script>
<script src="~/js/Mail.js/ajaxchimp.min.js"></script>
<script src="~/js/Mail.js/custom.js"></script>



@* ======== 泰迪localstorge start ======== *@


<script>let storage = localStorage
    function doFirst() {
        let itemString = storage.getItem('addItemList')
        let items = itemString.substring(0, itemString.length - 2).split(', ')
        // console.log(items)  // ['A1001', 'A1005', 'A1006', 'A1002']

        newDiv = document.createElement('div')
        newTable = document.createElement('table')

        // 將 table 放進 div，再將 div 放進 cartList
        newDiv.appendChild(newTable)
        document.getElementById('cartList').appendChild(newDiv)

        total = 0
        for (let i = 0; i < items.length; i++) {
            let itemInfo = storage.getItem(items[i])
            total += parseInt(itemInfo.split('|')[2])

            // 呼叫函數建立 <tr>
            createCartList(items[i], itemInfo)
        }
        document.getElementById('total').innerText = total
    }
    function createCartList(itemId, itemValue) {
        // alert(`${itemId}: ${itemValue}`)
        let itemTitle = itemValue.split('|')[0]
        let itemImage = 'imgs/' + itemValue.split('|')[1]
        let itemPrice = parseInt(itemValue.split('|')[2])

        // 建立每個品項的清單區域 -- tr
        let trItemList = document.createElement('tr')
        trItemList.className = 'item'

        newTable.appendChild(trItemList)

        // 建立商品圖片 -- 第一個 td
        let tdImage = document.createElement('td')
        tdImage.style.width = '200px'

        let image = document.createElement('img')
        image.src = itemImage
        image.width = 70

        tdImage.appendChild(image)
        trItemList.appendChild(tdImage)

        // 建立商品名稱和刪除按鈕 -- 第二個 td
        let tdTitle = document.createElement('td')
        tdTitle.style.width = '280px'
        tdTitle.id = itemId

        let pTitle = document.createElement('p')
        pTitle.innerText = itemTitle

        let delButton = document.createElement('button')
        delButton.innerText = 'Delete'
        delButton.addEventListener('click', deleteItem)

        tdTitle.appendChild(pTitle)
        tdTitle.appendChild(delButton)

        trItemList.appendChild(tdTitle)

        // 建立商品價格 -- 第三個 td
        let tdPrice = document.createElement('td')
        tdPrice.style.width = '170px'
        tdPrice.innerText = itemPrice

        trItemList.appendChild(tdPrice)

        // 建立商品數量 -- 第四個 td
        let tdItemCount = document.createElement('td')
        tdItemCount.style.width = '60px'

        let inputItemCount = document.createElement('input')
        inputItemCount.type = 'number'
        inputItemCount.value = 1
        inputItemCount.min = 1
        inputItemCount.addEventListener('input', changeItemCount)

        tdItemCount.appendChild(inputItemCount)
        trItemList.appendChild(tdItemCount)
    }
    function deleteItem(e) {
        // 找到刪除按鈕的那個品項的 id
        let itemId = e.target.parentNode.id

        // 1 扣除總金額，若要完成作業也要修改此處
        let itemValue = storage.getItem(itemId)

        // 作業: 找到刪除按鈕的那個品項的 inputItemCount 的 value 值

        total -= parseInt(itemValue.split('|')[2])

        document.getElementById('total').innerText = total

        // 2 清除 storage
        storage.removeItem(itemId)

        // let value = storage.getItem('addItemList')
        // let newValue = value.replace(`${itemId}, `,``)
        // storage.setItem('addItemList', newValue)

        storage['addItemList'] = storage['addItemList'].replace(`${itemId}, `, ``)

        // 3 刪除該筆 tr
        // e.target.parentNode.parentNode.parentNode.removeChild(e.target.parentNode.parentNode)
        newTable.removeChild(e.target.parentNode.parentNode)
    }
    function changeItemCount() {
        alert('這是作業')
    }
    window.addEventListener('load', doFirst);







    @* ========= API 串接區: 結帳將資料用post方式傳入資庫中 ========= *@

        function checkout() {
            let cartItems = []; // 用來存儲購物車商品信息的陣列

            // 獲取本地存儲中的商品信息
            for (let i = 0; i < localStorage.length; i++) {
                let key = localStorage.key(i);
                if (key !== 'addItemList') {
                    let itemInfo = localStorage.getItem(key).split('|');
                    let productId = key;
                    let productName = itemInfo[0];
                    let price = parseFloat(itemInfo[2]);

                    cartItems.push({ productId, productName, price });
                }
            }

            // 發送POST請求到後端API
            fetch('/api/order/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(cartItems)
            })
                .then(response => {
                    if (response.ok) {
                        // 清空本地存儲
                        localStorage.clear();
                        // 在此處執行訂單提交成功後的操作，例如顯示成功消息
                    } else {
                        // 在此處處理錯誤情況
                    }
                })
                .catch(error => {
                    // 在此處處理網絡錯誤
                });
        }


</script>











@* ======== Vue & axios start ======== *@


@{
}
